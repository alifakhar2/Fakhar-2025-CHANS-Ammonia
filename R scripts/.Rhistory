scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("NH"[3], " emission intensity (kg N Mg"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
); p3
inten.dat$variable <- factor(inten.dat$variable,
levels = c("Urea", "ammonium sulfate"),
labels = c("U = Urea", "AS = ammonium sulfate"))
colors <- c(
"U" = "#d95f02",
"AS" = "#48AAAD"
)
# NH3 intensity
p3 <- ggplot(inten.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_y_continuous(breaks = seq(0, 10, by = 2)) +  # <-- fixed here
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("NH"[3], " emission intensity (kg N Mg"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
); p3
View(inten.dat)
colors <- c(
"U" = "#d95f02",
"AS" = "#48AAAD"
)
# Plot total NH3
p1 <- ggplot(total.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("Total NH"[3], " (kg N ha"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "none",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
); p1
# Grain yield
p2 <- ggplot(grain.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_y_continuous(breaks = seq(0, 6, by = 1)) +
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("Grain yield (Mg ha"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "none",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
); p2
# NH3 intensity
p3 <- ggplot(inten.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_y_continuous(breaks = seq(0, 10, by = 2)) +  # <-- fixed here
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("NH"[3], " emission intensity (kg N Mg"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
); p3
p1 <- p1 +
annotate("text", x = -Inf, y = Inf, label = "A", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
p2 <- p2 +
annotate("text", x = -Inf, y = Inf, label = "B", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
p3 <- p3 +
annotate("text", x = -Inf, y = Inf, label = "C", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
combined_plot <- p1 / p2 / p3 +
plot_annotation(tag_levels = 'A') &
theme(plot.tag = element_text(size = 10, face = "bold", hjust = 0)); combined_plot
inten.dat <- inten.dat %>%
mutate(treatment_num = as.numeric(treatment),
value = as.numeric(value),
sd = as.numeric(sd))
colors <- c(
"U" = "#d95f02",
"AS" = "#48AAAD"
)
# Plot total NH3
p1 <- ggplot(total.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("Total NH"[3], " (kg N ha"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "none",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
); p1
# Grain yield
p2 <- ggplot(grain.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_y_continuous(breaks = seq(0, 6, by = 1)) +
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("Grain yield (Mg ha"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "none",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
); p2
# NH3 intensity
p3 <- ggplot(inten.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_y_continuous(breaks = seq(0, 10, by = 2)) +  # <-- fixed here
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("NH"[3], " emission intensity (kg N Mg"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
); p3
p1 <- p1 +
annotate("text", x = -Inf, y = Inf, label = "A", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
p2 <- p2 +
annotate("text", x = -Inf, y = Inf, label = "B", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
p3 <- p3 +
annotate("text", x = -Inf, y = Inf, label = "C", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
combined_plot <- p1 / p2 / p3 +
plot_annotation(tag_levels = 'A') &
theme(plot.tag = element_text(size = 10, face = "bold", hjust = 0)); combined_plot
library(ggplot2)
library(readxl)
library(tidyr)
library(dplyr)
library(ggbreak)
library(patchwork)
library(ggpmisc)
dat1 <- read_excel('/Users/AU775281/Documents/Msc Ali Fakhar/After Denmark/Manuscript CHANS and Field/Raw Data/Fig 4.xlsx')
colnames(dat1) <- dat1[1, ]
dat1 <- dat1[-1, ]
#Making seperate sub set for each plot
total <- dat1 %>% select(1:5)
grain  <- dat1 %>% select(1, 7:10)
inten <- dat1 %>% select(1, 12:15)
#Seperating Mean and SD values for plotting for Urea and AS treatments
total.mean <- total %>%
select(treatment, U, AS) %>%
pivot_longer(-treatment, names_to = "variable", values_to = "value")
grain.mean <- grain %>%
select(treatment, U, AS) %>%
pivot_longer(-treatment, names_to = "variable", values_to = "value")
inten.mean <- inten %>%
select(treatment, U, AS) %>%
pivot_longer(-treatment, names_to = "variable", values_to = "value")
total.sd <- total %>%
select(treatment, `U SD`, `AS SD`) %>%
rename(
U = `U SD`,
AS = `AS SD`
) %>%
pivot_longer(-treatment, names_to = "variable", values_to = "sd")
grain.sd <- grain %>%
select(treatment, `U SD`, `AS SD`) %>%
rename(
U = `U SD`,
AS = `AS SD`
) %>%
pivot_longer(-treatment, names_to = "variable", values_to = "sd")
inten.sd <- inten %>%
select(treatment, `U SD`, `AS SD`) %>%
rename(
U = `U SD`,
AS = `AS SD`
) %>%
pivot_longer(-treatment, names_to = "variable", values_to = "sd")
# Combine value and sd data frames
total.dat <- left_join(total.mean, total.sd, by = c("treatment", "variable"))
grain.dat <- left_join(grain.mean, grain.sd, by = c("treatment", "variable"))
inten.dat <- left_join(inten.mean, inten.sd, by = c("treatment", "variable"))
total.dat <- total.dat %>%
mutate(treatment_num = as.numeric(treatment),
value = as.numeric(value),
sd = as.numeric(sd))
grain.dat <- grain.dat %>%
mutate(treatment_num = as.numeric(treatment),
value = as.numeric(value),
sd = as.numeric(sd))
inten.dat <- inten.dat %>%
mutate(treatment_num = as.numeric(treatment),
value = as.numeric(value),
sd = as.numeric(sd))
colors <- c(
"U" = "#d95f02",
"AS" = "#48AAAD"
)
# Plot total NH3
p1 <- ggplot(total.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("Total NH"[3], " (kg N ha"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "none",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
); p1
# Grain yield
p2 <- ggplot(grain.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_y_continuous(breaks = seq(0, 6, by = 1)) +
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("Grain yield (Mg ha"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "none",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.x = element_blank(),
axis.text.x = element_blank(),
axis.ticks.x = element_blank()
); p2
# NH3 intensity
p3 <- ggplot(inten.dat, aes(x = treatment_num, y = value, color = variable)) +
geom_bar(stat = "identity", aes(fill = variable), position = position_dodge(width = 20), width = 20) +
geom_errorbar(aes(ymin = value - sd, ymax = value + sd),
position = position_dodge(width = 20), width = 5) +
geom_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE), se = FALSE) +
scale_y_continuous(breaks = seq(0, 10, by = 2)) +  # <-- fixed here
scale_x_continuous(breaks = seq(0, 90, by = 45)) +
stat_poly_eq(
aes(
label = paste(..eq.label.., ..rr.label.., sep = "~~~"),
group = variable
),
formula = y ~ poly(x, 2, raw = TRUE),
parse = TRUE,
hjust = -0.02,
vjust = 1.3,
label.x = min(total.dat$treatment_num),
show.legend = FALSE
) +
scale_color_manual(values = colors) +
scale_fill_manual(values = colors) +
labs(
x = "Treatment",
y = expression(paste("NH"[3], " emission intensity (kg N Mg"^{-1}, ")"))) +
theme_bw() +
theme(
axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12),
legend.title = element_blank(),
legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
); p3
p1 <- p1 +
annotate("text", x = -Inf, y = Inf, label = "A", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
p2 <- p2 +
annotate("text", x = -Inf, y = Inf, label = "B", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
p3 <- p3 +
annotate("text", x = -Inf, y = Inf, label = "C", hjust = -0.5, vjust = 1.5, size = 4, fontface = "bold")
combined_plot <- p1 / p2 / p3 +
plot_annotation(tag_levels = 'A') &
theme(plot.tag = element_text(size = 10, face = "bold", hjust = 0)); combined_plot
#Saving plot#
ggsave("/Users/AU775281/Documents/Msc Ali Fakhar/After Denmark/Manuscript CHANS and Field/Figures/Fig 4.png",
plot = combined_plot,
width = 5.5,
height = 11,
dpi = 300,
bg = "white")
